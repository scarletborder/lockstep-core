# Lockstep Client 测试应用

这是一个基于 React + Vite 的完整测试应用，用于测试 Lockstep WebTransport 客户端的所有功能。

## 快速开始

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm run dev

# 构建生产版本
pnpm run build
```

## 功能特性

### 1. 配置面板 (右上角)
- 服务器 URL 配置
- 安全选项配置（自签名证书、不安全传输等）
- 可折叠/展开的界面

### 2. HTTP 请求测试
- 获取房间列表
- 创建新房间
- 实时显示操作结果

### 3. WebTransport 连接测试
- 加入房间
- 断开连接
- 重连功能（使用密钥）
- 实时显示连接状态
- 显示当前玩家 ID 和房间信息

### 4. 游戏请求测试
完整测试所有游戏内请求消息：

#### 基础消息
- **心跳消息** (`blank`): 发送空白消息保持连接

#### 房间准备
- **准备/取消准备** (`ready`): 切换准备状态

#### 地图选择
- **选择地图** (`chooseMap`): 选择章节和关卡
- **离开选择** (`leaveChooseMap`): 退出地图选择

#### 加载状态
- **加载完成** (`loaded`): 标记资源加载完成

#### 游戏操作
- **种植** (`plant`): 在指定位置种植卡片
- **移除植物** (`removePlant`): 移除指定位置的植物
- **星星碎片** (`starShards`): 使用星之能力
- **结束游戏** (`endGame`): 发送游戏结束消息

### 5. 快速测试套件
- **完整流程测试**: 自动执行创建房间→加入→准备→选择地图→加载→断开的完整流程
- **重连流程测试**: 测试断线重连功能
- **消息压力测试**: 连续发送 50 条心跳消息，测试网络性能

### 6. 消息日志面板
- 实时显示所有收发的消息
- 按类型分类（大厅、房间、错误、状态、信息）
- 颜色编码便于识别
- 时间戳显示
- 可清空日志

## 使用方法

### 1. 配置服务器

1. 点击右上角的 "⚙️ 配置" 按钮
2. 设置服务器 URL（默认: `https://127.0.0.1:4433`）
3. 根据需要启用安全选项

### 2. 运行测试

#### HTTP 测试
1. 在 "HTTP 请求测试" 面板中输入房间 ID
2. 点击 "获取房间列表" 查看现有房间
3. 点击 "创建房间" 创建新房间

#### WebTransport 连接测试
1. 在 "WebTransport 连接" 面板中输入房间 ID
2. 点击 "加入房间" 建立连接
3. 观察连接状态变化
4. 连接成功后可以在 "游戏请求测试" 面板发送各种消息
5. 点击 "断开连接" 后可以使用保存的密钥重连

#### 游戏请求测试
1. 确保已连接到房间（状态显示为 "已连接"）
2. 在各个测试区域填写参数
3. 点击相应按钮发送请求
4. 在消息日志中查看服务器响应

#### 快速测试
1. 点击 "完整流程测试" 自动执行完整的测试流程
2. 点击 "重连流程测试" 测试断线重连功能
3. 先连接到房间，然后点击 "消息压力测试" 测试网络性能

## 技术栈

- **React 19**: UI 框架
- **TypeScript**: 类型安全
- **Vite**: 开发服务器和构建工具
- **lockstep-core-client**: Lockstep 客户端 SDK
- **WebTransport**: 底层传输协议

## 项目结构

```
src/
├── App.tsx                      # 主应用组件
├── App.css                      # 样式文件
├── components/                  # 组件目录
│   ├── ConfigPanel.tsx         # 配置面板
│   ├── HTTPTestPanel.tsx       # HTTP 测试面板
│   ├── ConnectionPanel.tsx     # 连接控制面板
│   ├── GameRequestPanel.tsx    # 游戏请求测试面板
│   ├── MessageLogPanel.tsx     # 消息日志面板
│   └── QuickTestPanel.tsx      # 快速测试面板
└── main.tsx                     # 应用入口
```

## 常见问题

### Q: 无法连接到服务器
A: 确保服务器正在运行，并且配置了正确的 URL 和安全选项

### Q: 收不到消息
A: 检查消息日志面板，确认连接状态为 "已连接"

### Q: 重连失败
A: 确保在断开连接前保存了重连密钥，并且房间仍然存在

## 相关链接

- [Lockstep Core 主项目](../../README.md)
- [TypeScript 客户端 SDK](../ts-app/README.md)
- [API 文档](../../docs/QUICK_REFERENCE.md)
